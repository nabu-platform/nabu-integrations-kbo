<sequence id="bae347a87b6642bca412fde531d3e9e0">
	<break id="be13daf2b4af405ba7866a1c204417e2"
		comment="Nothing to see here"
		label="input/updateDownloadId == null &amp;&amp; input/fullDownloadId == null">
		<count>1</count>
	</break>
	<map id="81ee23b6db8c4e62b4fdb0fd04aa6288"
		label="input/fullDownloadId != null">
		<invoke id="af6259416c274780a4abca9f6a0510a1"
			resultName="result9b2dae9636f0462eba196f2a6d37f098"
			serviceId="nabu.integrations.kbo.persist.generateTasksForDownload"
			x="30"
			y="30">
			<link id="24f72a3b5b6249c8ae6434669ea6a02e">
				<from>input/fullDownloadId</from>
				<to>downloadId</to>
			</link>
		</invoke>
		<link id="e8f9af9bdf114cb789c35a89a3a8e87c">
			<from>result9b2dae9636f0462eba196f2a6d37f098/downloadTaskIds</from>
			<to>downloadTaskIds</to>
		</link>
	</map>
	<for id="1d742a45140948c397314cbe8b29410f"
		variable="updateId">
		<map id="1ea935a49f7b4d3796f56a3bb7c15412">
			<invoke id="8a9595651fe9421592dbe5fdfe8f99b9"
				resultName="result1cd6bb978a5543c98d1c0718f3d52d6b"
				serviceId="nabu.integrations.kbo.persist.generateTasksForDownload"
				x="30"
				y="30">
				<link id="7f2ba46da12649118ca065d9738eaa03">
					<from>updateId</from>
					<to>downloadId</to>
				</link>
			</invoke>
			<invoke id="148394a7d347480d983b3078c80ad857"
				invocationOrder="1"
				resultName="result99253d4043dc4ef396ad8ed177d41fff"
				serviceId="nabu.utils.List.addAll"
				x="450"
				y="179">
				<link id="c151c6114b9244d29fa20767fa875694">
					<from>downloadTaskIds</from>
					<to>list</to>
				</link>
				<link id="bf2a6e5f447a43e896092a827499134d">
					<from>result1cd6bb978a5543c98d1c0718f3d52d6b/downloadTaskIds</from>
					<to>objects</to>
				</link>
			</invoke>
			<link id="a844b5dcdb8447d696f4882707e29c9e">
				<from>result99253d4043dc4ef396ad8ed177d41fff/list</from>
				<to>downloadTaskIds</to>
			</link>
		</map>
		<query>input/updateDownloadId</query>
	</for>
	<map id="9a9d3ec29fdb46498da2423189956c57"
		label="downloadTaskIds">
		<invoke id="29a6334773a8434081261f8bcca486db"
			resultName="result23915addb1494d8eace3d2d85553f6cf"
			serviceId="nabu.integrations.kbo.persist.processTasks"
			target="nabu.frameworks.tasks.providers.executor"
			x="246"
			y="117">
			<link id="c596ac625ff94db0bc50e0c3e8755110">
				<from>downloadTaskIds</from>
				<to>downloadTaskIds</to>
			</link>
			<targetProperties
					collectionIndex="queue">kbo</targetProperties>
		</invoke>
	</map>
	<map id="ec186284b9be4c70bc744a6506df8b02">
		<invoke id="ff7ac135a83a4f829bf72202f6c36d96"
			invocationOrder="1"
			resultName="result3ced216537eb45a7a84f4b685a70d7e9"
			serviceId="nabu.utils.List.add"
			x="117"
			y="75">
			<link id="a26e483dd0c24315bac96f658d5e5ece">
				<from>input/fullDownloadId</from>
				<to>object</to>
			</link>
			<link id="0ac251743f50408a8d5bae5bbebb11c3">
				<from>input/updateDownloadId</from>
				<to>list</to>
			</link>
		</invoke>
		<link id="6ed05d2511e944bc8e97603300eaa75f">
			<from>result3ced216537eb45a7a84f4b685a70d7e9/list[$this != null]</from>
			<to>allDownloadIds</to>
		</link>
	</map>
	<map id="501673648c6e4e1f8027100f82622d54"
		label="allDownloadIds != null">
		<invoke id="42f3a0e9e5734894ae3a74b3baf1b69f"
			invocationOrder="2"
			resultName="result42f3a0e9e5734894ae3a74b3baf1b69f"
			serviceId="nabu.integrations.kbo.crud.downloadTask.services.list"
			x="88"
			y="33">
			<link id="8ae021b44fa74b18af5acd1de3f49fb1">
				<from>allDownloadIds</from>
				<to>filter/downloadId</to>
			</link>
		</invoke>
		<link id="88d83acd43764360a64ba23617c90c93">
			<from>result42f3a0e9e5734894ae3a74b3baf1b69f/results</from>
			<to>existingTasks</to>
		</link>
		<invoke id="b5e350504f4e49b99e6b4458fcdec5fd"
			invocationOrder="3"
			resultName="resultb5e350504f4e49b99e6b4458fcdec5fd"
			serviceId="nabu.utils.List.unique"
			x="547"
			y="195">
			<link id="cef85f1c6a844228a6e863e28f359f75">
				<from>result42f3a0e9e5734894ae3a74b3baf1b69f/results/downloadId</from>
				<to>list</to>
			</link>
		</invoke>
		<link id="c37a01c5ce454201a2ca43a8d4407c8d">
			<from>resultb5e350504f4e49b99e6b4458fcdec5fd/list</from>
			<to>downloadsWithTasks</to>
		</link>
	</map>
	<map id="7b4f8f649ac94aa7ac3074e5c22714d1"
		comment="Get all downloads to finalize">
		<link id="fd55e7c4b852411b99ed7fd67c813467">
			<from>allDownloadIds[$this !# /downloadsWithTasks]</from>
			<to>downloadsToFinalize</to>
		</link>
	</map>
	<map id="012a24e54bd94f99a11cfeead4f65899"
		comment="Mark all downloads as processed"
		label="downloadsToFinalize != null">
		<invoke id="db3dbdbad84041cd91f794d644dd9f39"
			invocationOrder="1"
			resultName="resultb05888e9172f411fb213189245ba8ded"
			serviceId="nabu.integrations.kbo.persist.updateDownloadProcessed"
			x="492"
			y="65">
			<link id="2798d8fb9dc149f192027590a305c270">
				<from>result09f3d8f81c9943e490f4c1bc5e18cdf9/date</from>
				<to>parameters[0]/processed</to>
			</link>
			<link id="a4332782ee6b4479bf108ec7b8f440c7">
				<from>downloadsToFinalize</from>
				<to>parameters[0]/downloadIds</to>
			</link>
		</invoke>
		<invoke id="9e8030156bac483c9023ba620bc744dd"
			resultName="result09f3d8f81c9943e490f4c1bc5e18cdf9"
			serviceId="nabu.utils.Date.now"
			x="62"
			y="127">
		</invoke>
	</map>
</sequence>